<mat-sidenav-container class="ef-shell" autosize>
  <!-- Sidenav only shows if user is logged in -->
  <mat-sidenav *ngIf="isLoggedIn" class="ef-sidenav" [mode]="isMobile ? 'over' : 'side'" [(opened)]="sidenavOpened">
    <div class="ef-sidenav-header">
      <img src="logo.svg" alt="Eastern Feeds" class="sidebar-logo">
      <div class="user-info" *ngIf="currentUser$ | async as user">
        <span class="user-name">{{ user.name }}</span>
        <span class="user-role">{{ user.role }}</span>
      </div>
    </div>

    <mat-nav-list>
      <a mat-list-item routerLink="/dashboard" routerLinkActive="active-link">
        <mat-icon>dashboard</mat-icon>
        <span>Dashboard</span>
      </a>

      <a mat-list-item routerLink="/products" routerLinkActive="active-link">
        <mat-icon>inventory_2</mat-icon>
        <span>Products</span>
      </a>

      <a mat-list-item routerLink="/inventory" routerLinkActive="active-link">
        <mat-icon>warehouse</mat-icon>
        <span>Inventory</span>
      </a>

      <a mat-list-item routerLink="/orders" routerLinkActive="active-link">
        <mat-icon>shopping_cart</mat-icon>
        <span>Orders</span>
      </a>

      <a mat-list-item routerLink="/customers" routerLinkActive="active-link">
        <mat-icon>group</mat-icon>
        <span>Customers</span>
      </a>

      <!-- Suppliers restricted to Admin -->
      <a mat-list-item routerLink="/suppliers" routerLinkActive="active-link" *ngIf="hasRole(['Admin'])">
        <mat-icon>local_shipping</mat-icon>
        <span>Suppliers</span>
      </a>

      <!-- Reports restricted to Admin and Manager -->
      <a mat-list-item routerLink="/reports" routerLinkActive="active-link" *ngIf="hasRole(['Admin', 'Manager'])">
        <mat-icon>insights</mat-icon>
        <span>Reports</span>
      </a>

      <mat-divider></mat-divider>

      <a mat-list-item (click)="logout()" class="logout-item">
        <mat-icon>logout</mat-icon>
        <span>Logout</span>
      </a>
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content class="ef-content">
    <mat-toolbar color="primary" class="ef-toolbar" *ngIf="isLoggedIn">
      <button mat-icon-button class="ef-menu-button" (click)="toggleSidenav()" aria-label="Toggle sidenav">
        <mat-icon>menu</mat-icon>
      </button>

      <img src="logo-white.svg" alt="Eastern Feeds" class="toolbar-logo">

      <span class="ef-toolbar-spacer"></span>

      <div class="toolbar-user-info" *ngIf="currentUser$ | async as user">
        <span>{{ user.name }} ({{ user.role }})</span>
      </div>

      <button mat-icon-button class="ef-logout-button" (click)="logout()" title="Logout">
        <mat-icon>logout</mat-icon>
      </button>
    </mat-toolbar>

    <main [class.ef-main]="isLoggedIn" [class.ef-main-auth]="!isLoggedIn">
      <router-outlet></router-outlet>
    </main>

    <footer class="ef-footer" *ngIf="isLoggedIn">
      Eastern Feeds Management System Â© 2026
    </footer>
  </mat-sidenav-content>
</mat-sidenav-container>